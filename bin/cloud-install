#!/bin/sh

set -e

. /usr/share/cloud-installer/common/common.sh
. /usr/share/cloud-installer/common/maas.sh
. /usr/share/cloud-installer/common/juju.sh
. /usr/share/cloud-installer/common/configure.sh
. /usr/share/cloud-installer/common/multi.sh
. /usr/share/cloud-installer/common/single.sh

log="/var/log/cloud-install.log"
( umask 066 && touch "$log" )
exec 2>> "$log"

trap exitInstall EXIT
trap "" PIPE

#disableBlank

if [ ! -e /etc/.cloud-installed ]; then
	configureInstall
	case $install_type in
	Multi-system)
		exec /usr/share/cloud-installer/bin/cloud-install-multi $@
		;;
	"Single system")
		exec /usr/share/cloud-installer/bin/cloud-install-single $@
		;;
	"Landscape managed")
		;;
	*)
		exit 0
		;;
	esac
	touch /etc/.cloud-installed
	exitInstall
	cd "/home/$INSTALL_USER"; exec sudo -H -u "$INSTALL_USER" cloud-status
fi
